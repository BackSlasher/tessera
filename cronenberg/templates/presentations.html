
<!-- There's probably a much better, more idiomatic way to do all this
dispatching. But hey, this was quick and easy and is reasonably well
modularized for now. -->

<!-- ============================================================================= -->

{% macro render_separator(separator) -%}
<hr{% if separator.css_class != '' %}class="{{separator.css_class}}"{% endif %}></hr>
{% endmacro %}

<!-- ============================================================================= -->

{% macro render_singlestat(presentation) -%}
<div class="singlestat" id="{{presentation.element_id}}">
  <h3>{{ presentation.title }}</h3>
  <p><span class="value"></span><span class="unit">{{ presentation.units }}</span></p>
  <script>
    bean.on(cronenberg.queries.{{presentation.query_name}}, 'data-available', function(query) {
          var value = query.data[{{presentation.index}}].summation.{{presentation.transform}};
          $("#{{presentation.element_id}} span.value").number(value, {{presentation.decimal}});
      });
  </script>
</div>
{%- endmacro %}

<!-- ============================================================================= -->

{% macro render_simple_time_series(presentation) -%}
<div class="graph simple-time-series" id="{{presentation.element_id}}">
  <svg></svg>
  <script>
  bean.on(cronenberg.queries.{{presentation.query_name}}, 'data-available', function(query) {
      cronenberg.simple_line_chart($("#{{presentation.element_id}}"), query.data[0]);
  });
  </script>
</div>
{%- endmacro %}

<!-- ============================================================================= -->

<!-- TODO: cell & presentation rendering can be separated -->
{% macro render_stacked_area_chart(presentation) -%}
<div class="graph stacked-area-chart" id="{{presentation.element_id}}">
  <svg></svg>
  <script>
  bean.on(cronenberg.queries.{{presentation.query_name}}, 'data-available', function(query) {
      cronenberg.stacked_area_chart($("#{{presentation.element_id}}"), query.data);
  });
  </script>
</div>
{%- endmacro %}

<!-- ============================================================================= -->

{% macro render_presentation(presentation) -%}
  {% if presentation.presentation_type == 'singlestat' %}
    {{ render_singlestat(presentation) }}
  {% elif presentation.presentation_type == 'simple_time_series' %}
    {{ render_simple_time_series(presentation) }}
  {% elif presentation.presentation_type == 'stacked_area_chart' %}
    {{ render_stacked_area_chart(presentation) }}
  {% endif %}
{% endmacro %}

<!-- ============================================================================= -->

{% macro render_cell(cell) -%}
<div class="span{{ cell.span }}
{% if cell.offset %} offset{{ cell.offset }} {% endif %}
{% if cell.css_class %} {{ cell.css_class }} {% endif %}
"
{% if cell.align == 'center' %} align="center" {% endif %}
{% if cell.height %} height="{{cell.height}}" {% endif %}
>
  {% if cell.emphasize %}
    <div class="well">
  {% endif %}
  {{ render_presentation(cell.presentation) }}
  {% if cell.emphasize %}
    </div>
  {% endif %}
</div>
{%- endmacro %}

<!-- ============================================================================= -->

{% macro render_row(row) -%}  <div class="row dashboard-row">
    {% for cell in row.cells %}
      {{ render(cell) }}
    {% endfor %}  </div>
{% endmacro %}

<!-- ============================================================================= -->

{% macro render_grid(grid) -%}
  {% for row in grid.rows %}
    {{ render(row) }}
  {% endfor %}
{% endmacro %}

<!-- ============================================================================= -->

{% macro render(layout) -%}
  {% if layout.layout_type == 'grid' %}
    {{ render_grid(layout) }}
  {% elif layout.layout_type == 'row' %}
    {{ render_row(layout) }}
  {% elif layout.layout_type == 'cell' %}
    {{ render_cell(layout) }}
  {% elif layout.layout_type == 'separator' %}
    {{ render_separator(layout) }}
  {% endif %}
{% endmacro %}
